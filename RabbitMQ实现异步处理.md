# RabbitMQ 实现异步处理

基本实现思路是接收客户端请求，然后将请求的任务添加到消息队列，然后请求返回；
任务在队列中排队被发送到任务处理器处理。

如果需要知道处理状态，则可以在redis、MySQL数据库中记录任务状态，如添加任务的时候可以
在数据库添加一条数据，状态设置为"待处理"，处理完成后，设置数据状态为处理"成功"或"失败"。
在添加数据库记录消息处理状态的同时也引入了MQ和DB一致性的问题，为了解决这个问题，
开启channel的confirm模式与数据库操作组成事务。

为了防止MQ connection channel 异常要在这些对象的异常事件添加异常事件处理方法，
比如重连、重试。同时为了防止重启消息丢失还需要做持久化。

1）某条消息因为MQ网络断开导致处理失败，应该怎么重试？  
2）confirm模式怎么启用？  
3）为什么会出现消息多发和漏发？与一致性问题的关系？  
4）队列持久化和消息持久化？持久化和性能的权衡？  